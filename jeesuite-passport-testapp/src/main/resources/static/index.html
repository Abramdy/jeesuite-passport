<!DOCTYPE html>
<html>
 <head> 
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<meta name="renderer" content="webkit">
		<title>首页</title>
		<link rel="stylesheet" href="http://www.pintuer.com/css/pintuer.css">
		<script src="http://www.pintuer.com/js/jquery.js"></script>
		<script src="http://www.pintuer.com/js/pintuer.js"></script>
 </head> 
 <body> 
    <div style="margin-top: 50px;margin-left: 100px;font-size: 20;">
    	<div id="login_before">
    	   <a href="http://sso.vakin.io/auth/login?return_url=/login_callback&client_id=test">登录</a> <br>
		   <a href="../oauth2/login">Oauth2.0登录</a> <br>
		   <a href="../snslogin/osc">第三方平台登录</a> <br>
		   <a href="../snslogin/wxgzh?scope=snsapi_base">微信公众号登录</a><br>
		   <a href="javaScript:;" id="jsonploginbtn">JSONP跨域登录</a><br>
    	</div>
    	<div id="login_after" style="display: none;">    		
    		<input type="button" class="button" value="获取用户信息" onclick="getUserinfo();" />&nbsp;
		    <a class="" href="http://sso.vakin.io/logout">登出</a>
    	</div>
    </div>
 </body>

 <script> 
var sessionId;
$(document).ready(function() {
	getLoginStatus();
    if(sessionId){
        $('#login_before').hide();
        $('#login_after').show();
        //
        $.getJSON('http://sso.vakin.io/sso/get_setcookie_list',function(json){
            for (var i in json) {
            	setSSOCookies(json[i]);
            }
        });
    }
	
    $("#jsonploginbtn").click(function() {
        $.ajax({
            url: 'https://sso.vakin.io/jsonp/auth/login?username=15920558210&password=123456',
            type: "get",
            async: false,
            dataType: "jsonp",
            jsonp: "callback",
            jsonpCallback: "jsonpLoginCallback",
            success: function(json) {
               alert("code:" + json.code + ",msg:" + json.msg);
            },
            error: function() {
                alert('Error');
            }
        });
    });

    $(".J_logininfo_btn").click(function() {
    	getUserinfo();
    });
}); 

function getLoginStatus(){
	var url = "../logged/status";
    	$.ajax({
            type: "GET",
            async: false,
            url: url,
            dataType: "json",
            success: function(json) {
            	if(json.code == 200)sessionId= json.data;
            },
            error: function(a, b, c) {
            	sessionId = null;
            }
        });
}

function getUserinfo(){
	var url = "http://sso.vakin.io/user/info/" + sessionId;
    	$.ajax({
            type: "GET",
            crossDomain: true,
            url: url,
            dataType: "json",
            success: function(json) {
                alert("response json:" + JSON.stringify(json));
            },
            error: function(a, b, c) {
            }
        });
}

function setSSOCookies(ticket){
	$.ajax({
            url: 'http://sso.vakin.io/sso/setcookie?ticket='+ticket+'&session_id='+sessionId,
            type: "get",
            cache: false,
            dataType: "jsonp",
            jsonp: "callback",
            jsonpCallback: "jsonpSetCookieCallback",
            success: function(json) {
               if(json.code == 200){
               	 alert("跨域setCookies finish");
               }else{
                  alert(json.msg);
               }
            },
            error: function(a, b, c) {
                alert(a + b + c);
            }
        });
}


function setSSOCookies(ticket){
	$.ajax({
            url: 'http://sso.vakin.io/sso/setcookie?ticket='+ticket+'&session_id='+sessionId,
            type: "get",
            cache: false,
            async: false,
            dataType: "jsonp",
            jsonp: "callback",
            jsonpCallback: "jsonpSetCookieCallback",
            success: function(json) {
               if(json.code == 200){
               	 alert("跨域setCookies finish,ticket="+ticket);
               }else{
                  alert(json.msg);
               }
            },
            error: function(a, b, c) {
                alert(a + b + c);
            }
        });
} 
</script>  
</html>