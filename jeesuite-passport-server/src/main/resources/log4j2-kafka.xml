<?xml version="1.0" encoding="UTF-8"?>
<Configuration status="warn" name="tax" packages="com.jeesuite.springcloud.base.log">
  <Appenders>
    <RollingFile name="ErrorLogFileAppender" fileName="${sys:log.output.dir}${sys:appId}-error.log" filePattern="${sys:log.output.dir}${sys:appId}-error-%d{yyyy-MM-dd}-%i.log.gz">
      <PatternLayout pattern="%d{yyyy-MM-dd HH:mm:ss z} %-5level %class{36} %L %M - %msg%xEx%n"/>
      <SizeBasedTriggeringPolicy size="10M"/>
      <Filters>
         <ThresholdFilter level="error" onMatch="ACCEPT" onMismatch="DENY"/>
      </Filters>
     </RollingFile>
     <Kafka name="Kafka1" topic="log-callchain" ignoreExceptions="true">
        <!-- 时间 线程名 日志名 日志级别  全局请求id 用户id 会话id 环境类型  appid 日志内容-->
        <PatternLayout charset="UTF-8" pattern="[%date][%thread][%c{2}][%p][%X{logcontext-requestid}][%X{logcontext-userid}][%X{logcontext-sessionid}][%X{logcontext-envtype}][%X{logcontext-appid}]%m"/>
        <Property name="bootstrap.servers">${spring:kafka.bootstrap.servers}</Property>
        <Property name="retries">2</Property>
        <Property name="batch.size">16384</Property>
        <Property name="linger.ms">1</Property>
        <Property name="buffer.memory">10554432</Property>
        <Property name="max.request.size">5000000</Property>
        <Property name="send.buffer.bytes">5000000</Property>
    </Kafka>
     <Kafka name="Kafka2" topic="log-inner" ignoreExceptions="true">
        <!-- 时间 线程名 日志名 日志级别  全局请求id 用户id 环境类型  appid 日志内容 -->
        <PatternLayout charset="UTF-8" pattern="[%date][%thread][%c{2}][%p][%X{logcontext-requestid}][%X{logcontext-userid}][${spring:log.env}][${spring:log.appid}][${sys:logcontext-server}][${sys:logcontext-serverport}][%X{logcontext-url}][logcontext-logkey][%m][%throwable]"/>
        <Property name="bootstrap.servers">${spring:kafka.bootstrap.servers}</Property>
        <Property name="retries">2</Property>
        <Property name="batch.size">16384</Property>
        <Property name="linger.ms">1</Property>
        <Property name="buffer.memory">10554432</Property>
        <Property name="max.request.size">5000000</Property>
        <Property name="send.buffer.bytes">5000000</Property>
    </Kafka>
  </Appenders>
  <Loggers>
     <AsyncLogger name="com.jeesuiteframework.log.CallChainServerLogForSpringMVCFilter" level="${spring:log.callchain.level}" includeLocation="false">
      	<AppenderRef ref="Kafka1"/>
     </AsyncLogger>
     <AsyncLogger name="com.jeesuite" level="${spring:log.service.level}" includeLocation="false">
      	<AppenderRef ref="Kafka2"/>
     </AsyncLogger>
     <AsyncLogger name="com.jeesuite" level="${spring:log.framework.level}" includeLocation="false">
      	<AppenderRef ref="Kafka2"/>
     </AsyncLogger>
     <AsyncLogger name="com.jeesuiteframwork" level="${spring:log.framework.level}" includeLocation="false">
      	<AppenderRef ref="Kafka2"/>
     </AsyncLogger>
     <root level="ERROR">
		<appender-ref ref="ErrorLogFileAppender" />
	 </root>
    <Logger name="org.springframework" level="WARN" />
    <Logger name="org.apache.kafka" level="ERROR" /> <!-- avoid recursive logging -->
  </Loggers>
</Configuration>